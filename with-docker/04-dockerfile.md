# 五.DockerFile

## 是什么

Dockerfile 是用来构建 Docker 镜像的构建文件,是由一系列命令和参数构成的脚本

## 构建三步骤

1. 手动编写一个 dockerfile 文件,当然,必须要复合 file 的规范
2. 有这个文件后,直接 docker build 命令执行,获得一个自定义的镜像
3. run

## Dockerfile 内容基础知识

1. 每条保留字指令都必须为大写字母且后面要跟随至少一个参数
2. 指令按照从上到下,顺序执行
3. ’#‘表示注释
4. 每条指令都会创建一个新的镜像层,并对镜像进行提交

## Dockerfile 大致执行流程

1. docker 从基础镜像运行一个容器
2. 执行一条指令并对容器作出修改
3. 执行类似 docker commit 的操作提交一个新的镜像层
4. docker 再基于刚提交的镜像运行一个新容器
5. 执行 dockerfile 中的下一条指令直到所有指令都执行完成

## 保留字指令

1. FROM 基础镜像,当前镜像是基于哪个镜像的 (SCRATCH 祖先镜像)

2. MAINTAINER 镜像维护者的姓名和邮箱地址

3. RUN 容器构建时候需要执行的命令

4. EXPOSE 当前容器对外暴露出的端口

5. WORDKDIR 指定在创建容器后,终端默认登陆的进来工作目录,一个落脚点

6. ENV 用来在构建镜像过程中设置环境变量

7. ADD 将宿主机目录下的文件拷贝进镜像且*ADD 命令会自动处理 URL 和解压 tar 压缩包*

8. COPY 类似 ADD,拷贝文件和目录到镜像中.将从构建上下文目录中<源路径>的文件/目录复制到新的一层的镜像 内的<目标路径>位置

   COPY src dest

   COPY ['src', 'dest']

9. VOLUME 容器数据卷,用于数据保存和持久化工作

10. CMD

    - 指定一个容器启动时要运行的命令
    - **Dockerfile 中可以有多个 CMD 指令,但只有最后一个生效,CMD 会被 docker run 之后的参数替换**(和 ENTRTPOINT 的区别)


    ​	CMD指令的格式和RUN相似,也是两种格式

    - shell格式: CMD <命令>
    - exec格式: CMD['可执行文件','参数1','参数2',...]
    - 参数列表格式: CMD['参数1','参数2',...]在指定了ENTRTPOINT指令后,CMD指定具体的参数.

11. ENTRTPOINT

    - 指定一个容器启动时要运行的命令
    - ENTRTPOINT 的目的和 CMD 一样,都是在指定容器启动程序及参数**docker run 之后的参数会被追加**

12. ONBUILD 当构建一个被继承的 dockerfile 时运行命令,父镜像在被子镜像继承后父镜像的
